---
layout: post
title: 不安全的直接对象引用和安全配置错误和失效的访问控制
date: 2020-01-18 09:30
tags: web安全
excerpt: "本文介绍web安全漏洞-不安全的直接对象引用和安全配置错误和失效的访问控制的攻击与防御。"
toc: true
---	

## 1. 不安全的直接对象引用 (Insecure Direct Object References, IDOR)

### 什么是IDOR

不安全的直接对象引用是一种漏洞，攻击者可以通过操控请求中的参数，直接访问未经授权的对象或资源。通常表现在URL参数、表单数据或API请求中。

### 案例：用户资料的IDOR漏洞

#### 案例背景

某Web应用允许用户通过URL参数访问自己的个人资料信息，如下所示：

```bash
http://example.com/user?id=123
攻击者发现，通过修改URL中的`id`参数，可以访问其他用户的资料：
http://example.com/user?id=124
```

#### 漏洞利用

攻击者通过更改`id`参数值，获取了其他用户的敏感信息。

### 防御手段

- **访问控制**：验证请求中的参数是否与当前登录用户匹配。
- **间接引用**：使用随机生成的引用标识符代替直接的对象引用。
- **日志记录和监控**：记录和监控异常的参数变化行为。

## 2. 安全配置错误 (Security Misconfiguration)

### 什么是安全配置错误

安全配置错误是指系统、服务器或应用程序未按照安全最佳实践进行配置，导致安全漏洞。这可能包括默认账户和密码未更改、不必要的服务开启、错误的权限设置等。

### 案例：未禁用的调试模式

#### 案例背景

某Web应用在生产环境中未禁用调试模式，攻击者可以访问调试信息：

```
http://example.com/debug
```

#### 漏洞利用

攻击者通过访问调试页面，获取了服务器配置信息和环境变量，进一步利用这些信息进行攻击。

### 防御手段

- **安全配置基线**：建立和遵循安全配置基线，定期审核配置。
- **禁用不必要的功能**：在生产环境中禁用调试模式和不必要的服务。
- **最小权限原则**：仅授予必要的权限，减少攻击面。

## 3. 失效的访问控制 (Broken Access Control)

### 什么是失效的访问控制

失效的访问控制是指系统未能正确实施访问控制策略，导致未经授权的用户能够访问受限资源。常见的表现形式包括水平权限提升和垂直权限提升。

### 案例：水平权限提升

#### 案例背景

某Web应用允许用户通过URL参数访问自己的订单详情：

```go
http://example.com/order?orderId=123

攻击者发现，通过修改`orderId`参数，可以访问其他用户的订单：

http://example.com/order?orderId=124
```

#### 漏洞利用

攻击者通过更改`orderId`参数值，获取了其他用户的订单详情。

### 防御手段

- **严格的访问控制检查**：在每个受限资源访问点检查用户权限。
- **垂直和水平访问控制**：确保不同级别的用户具有适当的访问权限。
- **代码审计**：定期进行代码审计，识别和修复访问控制漏洞。

## 总结

不安全的直接对象引用、安全配置错误、失效的访问控制是常见的Web安全问题。通过实施严格的访问控制、遵循安全配置最佳实践和定期进行安全审计，可以有效防止这些漏洞的发生，保护Web应用的安全。
