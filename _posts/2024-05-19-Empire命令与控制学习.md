---
layout: post
title: Empire框架命令与控制学习
date: 2024-05-19 09:30
tags: C2，Empire框架
excerpt: "Empire恶意软件的分析记录。"
toc: true
---
## Empire框架
Empire C2流量是基于web的，并且该流量的特征在Malleable C2配置文件中定义。Malleable C2配置文件遵循易于定制的模板，允许攻击者根据其确切的规格定制C2流量
Malleable C2配置文件
   与 Malleable C2 配置文件关联的变量包括睡眠时间、用户代理、uri 以及客户端和服务器生成的 Web 流量的各种标头行。以 http-get 开头的部分定义了客户端和 C2 服务器之间的流量特征。
set uri 函数将客户端生成的 URI 分配给服务器。 术语 netbiosu 和 uri-append 指示会话密钥信息将被编码并附加到 HTTP 请求的 URI。
![image](https://github.com/kyre0e/kyre0e.github.io/assets/169347540/80defd21-d616-4292-ac40-fe1409946cea)
![image](https://github.com/kyre0e/kyre0e.github.io/assets/169347540/4bae829f-6796-4589-a1e5-8196937c42fe)

## Empire C2流量
![image](https://github.com/kyre0e/kyre0e.github.io/assets/169347540/69d3b61b-736c-4cec-9214-ac2c33f80fa1)

## 基于机器学习检测C2
由于有无限种可能的定制，基于签名的方法并不完全有效。
### 一种可能的选择是使用传统的基于机器学习的方法。
在传统方法中，机器学习从流量中提取C2活动的特征，这一工程称为特征工程。
研究人员可以从网络流量中提取特征，例如URI参数、Cookie数据和各种HTTP标头，以识别C2流量。
我们可以使用传统的机器学习算法（逻辑回归和支持向量机SVM）根据这些特征构建模型，以区分恶意C2流量和良性流量。
### 使用深度学习
卷积神经网络CNN
1.标准训练（standard） 
Empire C2 pcap 真实流量做训练
2.对抗性训练（adversarial）
