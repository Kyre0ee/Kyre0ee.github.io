---
layout: post
title: xss攻击与防御
date: 2020-01-11 09:30
tags: web安全
excerpt: "本文介绍web安全漏洞-xss技术的攻击与防御。"
toc: true
---

# XSS 攻击与防御

## 攻击技术细节：

XSS（Cross-Site Scripting）攻击是一种常见的web安全漏洞，攻击者通过在web应用中注入恶意脚本，使得用户的浏览器执行这些脚本，从而窃取用户信息、篡改页面内容等。常见的 XSS 攻击类型包括：

1. **存储型 XSS（Stored XSS）：** 攻击者将恶意脚本存储在服务器上，当用户访问含有恶意脚本的页面时，脚本被执行。这种类型的 XSS 攻击常见于用户上传内容、留言板等场景。
   
   - **攻击方式：** 攻击者将带有恶意脚本的内容上传到服务器，并等待用户访问含有该内容的页面。攻击者通常利用在用户上传的文本中插入 JavaScript 代码，如 `<script>alert('XSS')</script>`。
   
   - **风险：** 存储型 XSS 攻击可能导致所有访问受影响页面的用户都遭受攻击。
   - **示例：** 假设有一个论坛网站，用户可以在帖子中留言。攻击者在留言中插入以下恶意脚本：

```html
<script>alert('XSS')</script>
当其他用户访问包含该留言的页面时，就会弹出一个恶意的警告框。
```

   - **防御手段：** 对用户上传的内容进行严格的过滤和验证，移除或转义潜在的恶意脚本。此外，定期检查服务器上存储的数据，确保没有恶意脚本被插入。
   
2. **反射型 XSS（Reflected XSS）：** 攻击者将恶意脚本作为参数传递给服务器，服务器将参数直接插入到页面中，用户访问该页面时，脚本被执行。这种类型的 XSS 攻击常见于通过 URL 传递参数的场景。

   - **攻击方式：** 攻击者构造带有恶意脚本的 URL，诱使用户点击该 URL，触发 XSS 攻击。例如，攻击者构造的恶意 URL 可能是 `http://www.example.com/?name=<script>alert('XSS')</script>`。
   
   - **风险：** 反射型 XSS 攻击通常针对特定的用户，需要诱使用户点击恶意链接才能触发。

   - **示例：** 假设有一个搜索功能，用户可以通过在搜索框中输入关键词来搜索相关内容。攻击者构造了一个带有恶意脚本的搜索字符串：

```
http://www.example.com/search?q=<script>alert('XSS')</script>
当用户点击这个链接并执行搜索时，恶意脚本会被执行。
```
   - **防御手段：** 对用户输入的参数进行严格的输入验证和输出转义，确保不会直接将参数插入到页面中。

3. **DOM 型 XSS（DOM-based XSS）：** 攻击者利用客户端代码中的漏洞，通过修改DOM结构触发 XSS 攻击。这种类型的 XSS 攻击不经过服务器，而是直接在用户浏览器中执行恶意脚本。

   - **攻击方式：** 攻击者利用客户端代码中的漏洞，修改DOM结构，使得恶意脚本被执行。例如，攻击者可能通过修改页面 URL 中的 hash 值来触发 XSS 攻击。
   
   - **风险：** DOM 型 XSS 攻击较难检测和防御，因为攻击不涉及服务器端代码。

   - **示例：** 假设有一个网页中包含以下 JavaScript 代码：

```
var search = location.hash.substring(1);
document.write("Search result: " + search);
攻击者构造以下恶意 URL：
http://www.example.com/#<script>alert('XSS')</script>
当用户访问该 URL 时，页面上会出现一个恶意的警告框。
```
   - **防御手段：** 使用安全的客户端框架或库，避免出现DOM型 XSS 漏洞。此外，开发者应当对用户输入数据进行严格验证和处理，以减少攻击的可能性。

## 防御手段：

1. **输入验证和过滤：** 对用户输入的数据进行验证和过滤，去除或转义潜在的恶意脚本，包括限制输入的长度、类型和格式等。

2. **输出转义：** 在向用户展示数据时，对特殊字符进行转义，避免浏览器将其解释为脚本。例如，将 `<` 替换为 `&lt;`，将 `>` 替换为 `&gt;`。

3. **HTTPOnly 标记：** 在设置 cookie 时，使用 HTTPOnly 标记，防止 JavaScript 脚本访问敏感 cookie 数据。这样可以减少存储型 XSS 攻击的风险。

4. **Content Security Policy（CSP）：** 使用 CSP 限制页面加载的资源和执行的脚本，减少 XSS 攻击的可能性。CSP 可以指定允许加载的域名、禁止执行的脚本类型等。

5. **使用安全的编程语言和框架：** 使用安全性较高的编程语言和框架，如 Node.js 的 Express 框架自带一些安全防护机制。

