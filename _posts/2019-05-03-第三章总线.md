---
layout: post
title: 第三章 总线
date: 2019-05-03 15:57 +0800
tags: 计组-MIPS汇编
excerpt: "总线相关知识点"
toc: true
---
# 第三章

## 1. 总线的基本概念

### 计算机中三大部件的功能

- **中央处理器（CPU）**：执行指令（数据加工）
- **主存储器（MM）**：存储指令和数据
- **输入/输出（I/O）**：输入程序和数据，输出程序执行结果

计算机所有功能都是通过 CPU 执行指令来实现。指令和数据保存在主存储器、磁盘中，或从键盘直接输入数据。因此在 CPU 和主存之间、CPU 和键盘之间、主存和磁盘之间都需要有信息交换，需要有线路互连。这个互连的线路称为总线。

### 系统总线对主要功能部件的互连

![系统总线结构](https://github.com/Kyre0ee/Kyre0ee.github.io/assets/169347540/a3b5ccaf-7911-460a-8097-34b22da6ccee)

### 部件的功能和指令的执行过程

- 每个指令周期完成不同的操作任务，这些任务涉及：
  - CPU 从主存取指令、取数据
  - CPU 把结果数据送主存
  - CPU 送数据到 I/O 模块，或从 I/O 模块获得数据
  - 主存和 I/O 模块之间交换数据
  - I/O 模块将中断请求信号送 CPU
  - CPU 从 I/O 模块读取中断向量

### 部件间的信息交换

- **CPU <-> 主存**
  - CPU 须给出所访问的主存单元的地址信息
  - CPU 须给出读/写控制信息
  - CPU 和主存之间有数据交换

- **CPU <-> I/O 模块**
  - CPU 须给出所访问的 I/O 模块的地址信息
  - CPU 须给出读/写控制信息
  - CPU 和 I/O 模块之间有数据交换

- **I/O 模块 <-> 主存**
  - 在某些情况下 I/O 模块和主存之间可以直接交换数据
  - I/O 模块 (如 DMA 控制器) 要能给出所访问主存单元的地址
  - I/O 模块要能给出读/写控制信息

### 部件的外部特性

- 与其他部件间的互连信息（交换信息）
- 各部件的输入/出信息
  - **内部数据**：主机侧来的，如 CPU、主存
  - **外部数据**：外设送来的，如键盘、鼠标

## 2. 总线的分类及组成

### 总线的分类

- **内部总线**：指芯片内部连接各元件的总线，仅传输数据信息。
- **系统总线**：指连接 CPU、存储器和各种 I/O 模块等主要部件的总线，又称板级总线或板间总线，传输数据、地址和控制信息。
  - **处理器总线**：用于处理器与北桥芯片之间的信息交换。
  - **存储器总线**：用于处理器与主存储器之间的连接。
  - **I/O 总线**：用于为系统中的各种 I/O 设备提供输入/输出通路。
- **通信总线**：用于主机和 I/O 设备之间或计算机系统之间的通信。

### 系统总线的组成

- 一个系统总线通常由一组控制线、一组数据线和一组地址线构成。
  - **数据线**：承载在源和目的部件之间传输的信息，如指令、操作数等。数据线的宽度反映一次能传送的数据的位数。
  - **地址线**：给出源数据或目的数据所在的主存单元或 I/O 端口的地址。地址线的宽度反映最大的寻址空间。
  - **控制线**：控制对数据线和地址线的访问和使用。用来传输定时信号和命令（读、写）等信息。典型的控制信号包括：
    - 时钟：用于总线同步
    - 复位：初始化所有设备
    - 总线请求：表明发出该请求信号的设备要使用总线
    - 总线允许：表明接收到该允许信号的设备可以使用总线
    - 中断请求：表明某个中断正在请求
    - 中断回答：表明某个中断请求已被接受
    - 存储器读：从指定的主存单元中读数据到数据总线上
    - 存储器写：将数据总线上的数据写到指定的主存单元中
    - I/O 读： 从指定的 I/O 端口中读数据到数据总线上
    - I/O 写：将数据总线上的数据写到指定的 I/O 端口中
    - 传输确认：表示数据已被接收或已被送到总线上

## 3. 总线的特性和性能指标

总线是一组电导线，在部件间共享传输信息。总线标准需规定以下基本特性：

### 基本特性

- **物理机械特性**：连接类型、数量、接插件的几何尺寸和形状以及引脚线的排列等。
  - 连线类型：电缆式、主板式、底板式
  - 连线数量：串行总线、并行总线

- **电气特性**：每条信号线的信号传递方向、信号的有效电平范围
  - 信号方向：数据为双向、地址为单向、控制为单向
  - 电平表示方式：单端方式、差分方式

- **功能特性**：总线中每根传输线的功能

- **时间特性**：总线中任一根传输线在什么时间有效，以及每根线产生的信号之间的时序关系

### 性能指标

- **总线宽度**： 数据线的宽度（8/16/32/64/128 位等）
- **信号线类型**：专用信号线/复用信号线
- **仲裁方式**：集中式仲裁/分布式仲裁
- **定时方式**：同步通信/异步通信
- **事务类型**：所支持的数据传输类型和其他总线操作类型
- **工作频率**：总线的工作频率可等于或高于时钟频率。
- **总线带宽**：每秒钟在总线上能传输的最大字节数。

## 4. 总线结构

### 单总线结构

早期计算机采用单总线结构：
- CPU、主存与 I/O 模块之间的传送都通过一组总线进行。PDP-11 和国产 DJS183 采用该结构。
- **优点**：体系结构简单、便于扩充。
- **缺点**：所有传送都共享一组总线，易成为瓶颈，导致性能下降。

### 多总线结构

#### 双总线结构

- **不分层次**：在单总线基础上再加一条 CPU 与主存之间的通路，形成以存储器为中心的双总线结构。
- **分层次**：将 I/O 分离出来，集中由 I/O 模块管理，形成两级双总线结构。

#### 三总线结构

- **不分层次**：在以主存为中心的双总线结构中，将 I/O 和主存从系统总线上分离开来。
- **分层次**：CPU 和 Cache 间通过专门的局部总线相连，Cache 同时与主存用主存总线相连，引入扩展 I/O 总线。

#### 多总线分层结构

四总线结构：Cache 在 CPU 芯片中，CPU 通过前端局部总线连接 I/O 桥，再通过存储器总线与主存连接。

## 5. 总线裁决控制

### 完成一次总线传输的四个阶段

1. 总线裁决：决定哪个主控设备使用总线
2. 寻址阶段：主控设备送出要访问的主存设备的地址和相关命令
3. 数据传输阶段：主、从设备间进行数据交换
4. 结束阶段：撤销相关信息，让出总线使用权

### 总线裁决方式

- **集中裁决方式**：通过总线控制器进行裁决
- **分布裁决方式**：控制逻辑分散在各个部件或设备中

### 总线裁决信号线

- **类型**：总线请求线、总线许可线、总线忙
- **使用方式**：专用/复用

### 裁决方案的平衡

- **集中裁决**：控制逻辑单一，易实现，但单一决策容易造成总线冲突。
- **分布裁决**：各部件独立决策，相互独立，但设计复杂，易出错。

- 裁决方案应在以下两个因素间进行平衡：
  - **等级性**：具有高优先级的设备应该先被服务。
  - **公平性**：即使是具有最低优先权的设备也不能永远得不到总线使用权。

+ 集中式总线判优方式有三种：

  1. **链式查询**
      - **基本思想**：使用三根线进行总线控制（BS-总线忙、BR-总线请求、BG-总线允许）。BG信号从最高优先级设备依次向最低设备串行传送。如果BG到达的设备有总线请求，则BG信号不再传递，该设备建立总线忙BS信号，表示它已获得总线使用权。
      - **优点**：简单、易于扩展。
      - **缺点**：不能保证公平性、对电路故障敏感、链式查询速度变慢。
      ![链式查询图示](https://github.com/Kyre0ee/Kyre0ee.github.io/assets/169347540/82a4ba61-24a9-4007-ba6c-0477dd479df5)

  2. **计时器定时查询**
      - **基本思想**：比链式查询多一组设备线，无BG线。在接收到总线请求信号后，在BS=0（不忙）的情况下，计数器开始计数，并由设备先发出计数值。当某个有总线请求的设备与计数值一致时，该设备获得总线使用权，同时建立总线忙BS信号。
      - **优点**：灵活（通过设置不同的计数初值可改变优先级）、对电路故障不太敏感。
      - **缺点**：增加了一组设备线、总线设备控制逻辑复杂。
      ![计时器定时查询图示](https://github.com/Kyre0ee/Kyre0ee.github.io/assets/169347540/2a76a41f-d916-4aa9-9f91-8b439d8b9172)

  3. **独立请求**
      - **基本思想**：每个设备有一对总线请求线和总线允许线。当某设备要使用总线时，将请求信号送至总线控制器，其判优电路可根据各设备优先级确定使用权。控制器可给各请求线设定固定或可编程优先级。
      - **优点**：响应速度快，优先级可灵活设置（如果是可编程的总线控制器）。
      - **缺点**：控制逻辑复杂、控制线量大。
      - **裁决算法**：由总线控制器中的硬件实现，可采用固定的并行判优算法、平等的循环链算法、动态优先级算法等。
      ![独立请求图示](https://github.com/Kyre0ee/Kyre0ee.github.io/assets/169347540/7e782c31-4422-4f76-8361-96b3b8c88d9d)

    
## 6. 总线标准和总线控制器

### 总线标准

- **ISA 总线**：Industry Standard Architecture，是 IBM 公司在 PC 机上推出的第一个总线标准，是 8 位总线，后来发展到 16 位。
- **PCI 总线**：Peripheral Component Interconnect，是一种通用总线标准，支持 32 位或 64 位数据传输，支持 Plug and Play。
- **AGP 总线**：Accelerated Graphics Port，是为图形加速卡设计的总线标准，相较于 PCI 总线速度更快。
- **USB 总线**：Universal Serial Bus，是一种用于计算机与外部设备连接的总线标准，具有热插拔和热交换功能。
- **PCI Express 总线**：是一种高速串行总线标准，主要用于连接高性能设备，如图形卡、固态硬盘等。

### 总线控制器

总线控制器负责管理总线上的数据传输、地址传输和控制信号的生成和传送。

- **主机桥**：负责处理器与内存、显卡、PCI 总线等之间的通信。
- **南桥**：负责处理 I/O 设备与内存、PCI 总线等之间的通信。
- **PCI 桥**：用于连接不同 PCI 总线，或者将 PCI 总线连接到其他总线上。
- **DMA 控制器**：直接内存存取控制器，负责管理设备对内存的直接访问。

## 7. 总线控制器的功能和性能指标

### 功能

- **地址译码**：将 CPU 提供的地址译码为对应的设备地址。
- **数据传送**：负责将数据从 CPU、内存等设备传输到 I/O 设备，或者反向传输。
- **总线仲裁**：协调多个设备之间对总线的访问，避免冲突。
- **中断控制**：管理各个设备的中断请求，并将其传送给 CPU 处理。
- **DMA 控制**：管理直接内存存取操作，以提高数据传输效率。

### 性能指标

- **带宽**：表示单位时间内总线传输的数据量，通常以每秒传输的比特数或字节数表示。
- **响应时间**：指设备对 CPU 请求的响应时间，即设备收到请求后开始执行操作所需的时间。
- **吞吐量**：表示单位时间内总线处理的数据量，通常以每秒处理的比特数或字节数表示。
- **时钟频率**：表示总线的工作时钟频率，通常以赫兹（Hz）为单位。
- **延迟**：指从 CPU 发出请求到设备响应的时间间隔，通常以纳秒（ns）为单位。

## 8. 总线连接和总线控制

### 总线连接

- **并行连接**：多条数据线同时传输数据，速度较快，但受到干扰较大，线路复杂。
- **串行连接**：一条数据线逐位传输数据，速度较慢，但抗干扰能力强，线路简单。

### 总线控制

- **硬件控制**：使用硬件电路实现总线的控制功能，速度快，但灵活性差。
- **软件控制**：使用软件程序实现总线的控制功能，灵活性高，但速度较慢。

## 9. 总线管理和总线扩展

### 总线管理

- **总线监视**：通过监视总线上的信号来了解总线的工作状态和性能指标。
- **总线调度**：根据系统的需求和总线的状况，合理安排各设备对总线的使用顺序，以优化系统性能。

### 总线扩展

- **总线转换**：将一种总线转换为另一种总线，以满足不同设备的连接需求。
- **总线桥接**：连接两种不同的总线，使其能够相互通信。
- **总线延长**：通过增加中继器或信号放大器等设备来延长总线的传输距离。
## 10. 总线技术的发展趋势

### 高速化

- **提高带宽**：采用更高速的传输技术，如 DDR、QDR 等，提高总线带宽。
- **增加通道数量**：增加总线通道数量，实现并行传输，提高数据传输速度。

### 低功耗

- **采用低功耗设计**：通过优化电路设计、降低工作电压等方式，减少总线的功耗。
- **动态频率调节**：根据系统负载情况动态调整总线工作频率，降低功耗。

### 高可靠性

- **冗余设计**：采用冗余结构设计，提高总线的容错能力，减少故障发生的可能性。
- **错误检测与纠正**：增加错误检测与纠正机制，及时发现并修复总线传输中的错误。

### 更广泛的应用

- **支持多种设备**：适应不同设备接口标准，提供更广泛的设备连接支持。
- **应用领域扩展**：将总线技术应用于更多领域，如物联网、人工智能等，拓展总线技术的应用范围。

## 结语

总线技术作为计算机系统中重要的组成部分，不断发展与演进。随着科技的进步和应用需求的不断变化，总线技术也将持续创新，为计算机系统提供更高性能、更可靠的数据传输服务。


