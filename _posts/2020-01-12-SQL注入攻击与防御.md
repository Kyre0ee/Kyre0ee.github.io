---
layout: post
title: SQL 注入攻击与防御
date: 2020-01-12 09:30
tags: web安全
excerpt: "本文是关于SQL 注入攻击与防御的笔记"
toc: true
---
# SQL 注入攻击与防御

## 攻击技术细节：

### 1. 基于错误的 SQL 注入（Error-based SQL Injection）：

基于错误的 SQL 注入是通过向应用程序发送恶意的 SQL 查询，利用数据库返回的错误消息来获取敏感信息或执行未授权的操作。攻击者通过构造恶意的输入，比如在输入框中插入特定的 SQL 代码，来触发应用程序对数据库的错误响应，从而获取目标数据库的信息。

#### 示例：

假设一个网站有一个登录页面，用户可以通过输入用户名和密码进行登录。攻击者在用户名输入框中输入以下内容：
```
' OR 1=1 --
当应用程序将这段代码插入到 SQL 查询中时，查询变为：
SELECT * FROM users WHERE username = '' OR 1=1 --' AND password = 'input_password';
由于 1=1 总是成立，这个查询将返回所有用户的信息，从而绕过了身份验证。
```
#### 防御手段：

* 使用参数化查询：使用预编译语句或存储过程等方式，将用户输入的数据作为参数传递给 SQL 查询，而不是直接拼接到查询字符串中。

* 输入验证和过滤：对用户输入的数据进行严格的验证和过滤，确保不含恶意代码。

### 2. 基于时间的 SQL 注入（Time-based SQL Injection）：

基于时间的 SQL 注入是通过向应用程序发送恶意的 SQL 查询，利用查询执行时间的差异来判断数据库是否受到注入攻击。攻击者构造的恶意查询会导致数据库执行时间延长，从而可以通过观察响应时间的变化来确定注入点并获取敏感信息。

#### 示例：
假设一个网站有一个搜索功能，用户可以通过在搜索框中输入关键词来搜索相关内容。攻击者在搜索框中输入以下内容：

```
' AND IF(SUBSTRING(database(),1,1)='a',sleep(5),1) --
```

如果查询结果的响应时间延长了，说明数据库中的第一个字符是 'a'，否则不是。

#### 防御手段：

* 使用参数化查询：避免直接拼接用户输入到 SQL 查询字符串中。

* 数据库权限控制：限制应用程序连接数据库的权限，确保应用程序只能执行必要的操作。

### 对比各种攻击方式：

*  基于错误的 SQL 注入通常会导致错误消息泄露，但需要在应用程序中显示这些错误消息。
*  基于时间的 SQL 注入更为隐蔽，不会产生错误消息，但需要通过观察响应时间来确认注入点，攻击成功率较低。
