---
layout: post
title: 第五章 传输层
date: 2019-04-05 15:57 +0800
tags: 计算机网络
excerpt: "计算机网络-传输层学习笔记。"
toc: true
---
# 1. 传输层概论

## 1.1 传输层的作用

传输层位于网络层之上，负责端到端的通信服务，其主要功能包括：

- 端到端的连接管理
- 数据传输的可靠性保证
- 流量控制
- 拥塞控制

传输层通过端口号来区分不同应用程序，确保数据能够传输到正确的应用程序。

## 1.2 传输层的两大协议

### TCP（Transmission Control Protocol）

- **特点**：
  - 面向连接：通信前需要建立连接，通信结束后需要释放连接。
  - 可靠传输：通过序列号、确认机制、重传控制、流量控制等确保数据可靠传输。
  - 有序传输：数据按序发送和接收。
  - 全双工通信：通信双方可以同时发送和接收数据。

- **三次握手**：建立连接
  1. 客户端发送SYN报文，进入SYN_SENT状态。
  2. 服务器收到SYN报文，回应SYN+ACK报文，进入SYN_RCVD状态。
  3. 客户端收到SYN+ACK报文，回应ACK报文，连接建立，双方进入ESTABLISHED状态。

- **四次挥手**：释放连接
  1. 客户端发送FIN报文，进入FIN_WAIT_1状态。
  2. 服务器收到FIN报文，回应ACK报文，进入CLOSE_WAIT状态。
  3. 服务器发送FIN报文，进入LAST_ACK状态。
  4. 客户端收到FIN报文，回应ACK报文，进入TIME_WAIT状态，然后进入CLOSED状态。

### UDP（User Datagram Protocol）

- **特点**：
  - 无连接：数据传输前不建立连接。
  - 不可靠传输：不保证数据的送达，不进行重传。
  - 数据报模式：以独立的数据报文形式发送数据，不保证数据顺序。
  - 轻量级：传输效率高，开销小。

- **应用场景**：适用于对实时性要求高、对数据可靠性要求低的应用，如视频直播、在线游戏、DNS查询等。

# 2. TCP协议详解

## 2.1 TCP连接管理

- **连接建立**：通过三次握手机制建立连接，确保双方都准备好进行数据传输。
- **连接释放**：通过四次挥手机制释放连接，确保双方都完全关闭通信。

## 2.2 TCP可靠性保证

- **序列号**：为每个数据包分配唯一的序列号，确保数据按序到达。
- **确认机制**：接收方接收数据后发送确认报文，确认收到的数据。
- **重传控制**：未收到确认报文时，发送方重传数据包。
- **流量控制**：使用滑动窗口机制，根据接收方的处理能力调整发送数据的速率。
- **拥塞控制**：通过慢启动、拥塞避免、快重传、快恢复等算法控制网络拥塞。

## 2.3 TCP流量控制

- **滑动窗口机制**：发送方根据接收方的窗口大小控制发送数据的数量，防止接收方缓存溢出。
- **窗口调整**：接收方根据自身缓冲区的剩余空间，动态调整窗口大小，通知发送方。

## 2.4 TCP拥塞控制

- **慢启动**：发送方从小到大逐步增加发送窗口大小，避免突然拥塞。
- **拥塞避免**：发送方在慢启动后，线性增长窗口大小，避免拥塞。
- **快重传**：接收方连续收到三个相同的ACK报文，立即重传丢失的数据包。
- **快恢复**：重传数据包后，发送方不进入慢启动，而是将窗口大小减半，继续传输数据。

# 3. UDP协议详解

## 3.1 UDP特点

- 无连接：发送数据前不需要建立连接。
- 不可靠传输：不保证数据的正确性和完整性，不进行重传。
- 数据报模式：每个数据报独立发送，接收顺序不固定。
- 轻量级：头部开销小，传输效率高。

## 3.2 UDP应用场景

- **实时应用**：对实时性要求高的数据传输，如视频直播、在线游戏、语音通话。
- **简单查询**：对数据可靠性要求不高的应用，如DNS查询、SNMP管理。

## 3.3 UDP的优势和劣势

- **优势**：传输效率高，适用于对实时性要求高的场景。
- **劣势**：不可靠传输，数据容易丢失和错误。

# 4. 传输层端口号

- **端口号**：用于区分同一主机上的不同应用程序，16位。
- **范围**：
  - 0-1023：知名端口号，分配给常见应用协议，如HTTP（80）、HTTPS（443）、FTP（21）。
  - 1024-49151：注册端口号，分配给用户进程或应用程序。
  - 49152-65535：动态端口号或私有端口号，通常用于客户端临时连接。

